---
layout: post
title:  "计数排序及优化"
date:   2015-05-08 17:33:00
meta_description: 计数排序不是基于比较的排序算法,速度是线性的
categories:
- blog
tags:
- 排序
---

[计数排序][count]是一种相对简单的排序算法，计数排序使用一个额外的数组C，其中第i个元素是待排序数组A中值等于i的元素的个数。然后根据数组C来将A中的元素排到正确的位置。它不是基于比较的排序算法，所以没有比较法最快nlog(N)的速度极限，计数排序的速度是线性的，时间复杂度是Ο(n+k)，快于其他基于比较的排序算法。不过计数排序需要额外的数组，所以它一般只适用于小范围集合的排序。

下面说给出维基百科里对算法的解释：

>当输入的元素是 n 个 0 到 k 之间的整数时，它的运行时间是 Θ(n + k)。计数排序不是比较排序，排序的速度快于任何比较排序算法。

>由于用来计数的数组C的长度取决于待排序数组中数据的范围（等于待排序数组的最大值与最小值的差加上1），这使得计数排序对于数据范围很大的数组，需要大量时间和内存。例如：计数排序是用来排序0到100之间的数字的最好的算法，但是它不适合按字母顺序排序人名。但是，计数排序可以用在基数排序中的算法来排序数据范围很大的数组。

>通俗地理解，例如有10个年龄不同的人，统计出有8个人的年龄比A小，那A的年龄就排在第9位,用这个方法可以得到其他每个人的位置,也就排好了序。当然，年龄有重复时需要特殊处理（保证稳定性），这就是为什么最后要反向填充目标数组，以及将每个数字的统计减去1的原因。

>算法的步骤如下：

>1. 找出待排序的数组中最大和最小的元素
>2. 统计数组中每个值为i的元素出现的次数，存入数组C的第i项
>3. 对所有的计数累加（从C中的第一个元素开始，每一项和前一项相加）
>4. 反向填充目标数组：将每个元素i放在新数组的第C(i)项，每放一个元素就将C(i)减去1

我自己实现的过程中发现，觉得上面算法中的对c数组大小的处理不是很恰当。

举个极端的例子：如果排序的数组有200W个元素，但是这200W个数的值都在1000000-1000100，也就说有100个数，总共重复了200W次，现在要排序，怎么办？

这种情况排序，计数排序应该是首选。但是这时候n的值为200W，如果按原来的算法，k的值10001000，但是此时c中真正用到的地方只有100个，这样对空间造成了极大的浪费。

所以应该改进算法，减小c的大小，可以让c的大小减小到100，不然算法没法用。下面是优化版本的代码：

{% highlight java %}

public class CountingSort {
    public static void main(String[] argv) {
        int[] A = CountingSort.countingSort(new int[]{16, 4, 10, 14, 7, 9, 3, 2, 8, 1});
        Utils.print(A);
    }
 
    public static int[] countingSort(int[] A) {
        int[] B = new int[A.length];
        // 假设A中的数据a'有，0<=a' && a' < k并且k=100
        int k = 100;
        countingSort(A, B, k);
        return B;
    }
 
    private static void countingSort(int[] A, int[] B, int k) {
        int[] C = new int[k];
        // 计数
        for (int j = 0; j < A.length; j++) {
            int a = A[j];
            C[a] += 1;
        }
        Utils.print(C);
        // 求计数和
        for (int i = 1; i < k; i++) {
            C[i] = C[i] + C[i - 1];
        }
        Utils.print(C);
        // 整理
        for (int j = A.length - 1; j >= 0; j--) {
            int a = A[j];
            B[C[a] - 1] = a;
            C[a] -= 1;
        }
    }
}

{% endhighlight %}


[count]: http://zh.wikipedia.org/zh-cn/计数排序